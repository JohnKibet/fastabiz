@page "/merchant/products"
@layout MerchantLayout
@using System.Text.Json
@using frontend.Models
@inject ProductService ProductService

<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
  @foreach (var product in products)
  {
    <MerchantProductCard Product="@product" />
  }
</div>

@code {
  [CascadingParameter] public ActiveStoreContext StoreCtx { get; set; } = default!;
  private List<ProductListItem> products = new();

  protected override async Task OnInitializedAsync()
  {
    // Get products
    var result = await ProductService.ListAllStoreProducts(StoreCtx.StoreId);
    if (result.Success && result.Data != null)
    {
      products = result.Data;
      @* Console.WriteLine(JsonSerializer.Serialize(products, new JsonSerializerOptions
      {
        WriteIndented = true
      })); *@
    }
    else
    {
      products = new List<ProductListItem>();
    }
  }
}

@* Store order of precedence *@
@* 1. Explicit switch by user (always wins)
2. Pinned/default store (user preference)
3. Last used store (localStorage)
4. Fallback â†’ first store *@


@* logic *@
@* var pinnedStoreId = await LocalStorage.GetItem<Guid?>("pinned_store");

ActiveStore = stores.FirstOrDefault(s => s.Id == pinnedStoreId)
           ?? stores.OrderByDescending(s => s.Revenue).First(); *@
