@inherits LayoutComponentBase
@namespace frontend.Pages.Merchant
@using System.Text.Json
@using frontend.Models
@using frontend.Pages.Shared.Layout
@inject StoreService StoreService

<CascadingValue Value="ActiveStore">
    <CascadingValue Value="ActiveProduct">
        <AuthorizedLayout>
            @Body
        </AuthorizedLayout>
    </CascadingValue>
</CascadingValue>

@code {
    private ActiveStoreContext ActiveStore = new();
    private ActiveProductContext ActiveProduct = new();
    private List<ActiveStoreContext> stores = new();
    protected override async Task OnInitializedAsync()
    {
        // Fetch merchant stores
        var result = await StoreService.GetStoresByOwner();
        if (result.Success && result.Data?.Any() == true)
        {
            // Decide which store becomes active
            var store = result.Data[0];
            ActiveStore = new ActiveStoreContext
            {
                StoreId = store.StoreId,
                StoreName = store.StoreName
            };
        }
        else
        {
            stores = new();
        }
    }
}