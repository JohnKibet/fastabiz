@page "/auth/register"
@layout PublicLayout
@using MudBlazor
@using MudVariant = MudBlazor.Variant
@inject NavigationManager Navigation

<MudThemeProvider Theme="_theme" />

<MudLayout>
    <MudAppBar Elevation="2" Color="Color.Surface" Fixed="true">
        <MudText Typo="Typo.h5" Style="font-weight:800; cursor:pointer;" @onclick='() => Navigation.NavigateTo("/")'>
            FastaBiz
        </MudText>
    </MudAppBar>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Medium" Class="d-flex flex-column align-center justify-center" Style="min-height:100vh; padding-top:100px; padding-bottom:60px;">

            <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-2" Style="font-weight:800;">
                Join FastaBiz
            </MudText>
            <MudText Typo="Typo.subtitle1" Align="Align.Center" Class="mb-10 mud-text-secondary">
                Are you a Business Owner or a Customer?
            </MudText>

            <!-- Role Cards -->
            <MudGrid Justify="Justify.Center" Spacing="4">

                <!-- Merchant -->
                <MudItem xs="12" sm="5">
                    <MudPaper @onclick="@(() => SelectRole("merchant"))"
                              Elevation="@(selectedRole == "merchant" ? 6 : 2)"
                              Class="@($"pa-8 rounded-xl d-flex flex-column align-center justify-center role-card {(selectedRole == "merchant" ? "role-selected" : "")}")"
                              Style="@($"border: 2px solid {(selectedRole == "merchant" ? "var(--mud-palette-primary)" : "transparent")}; cursor:pointer; transition:all 0.2s; position:relative; min-height:180px;")">
                        @if (selectedRole == "merchant")
                        {
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Primary" Style="position:absolute; top:12px; right:12px;" />
                        }
                        <MudText Style="font-size:3rem;">üßë‚Äçüíº</MudText>
                        <MudText Typo="Typo.h6" Class="mt-2" Style="font-weight:700;">Business Owner</MudText>
                        <MudText Typo="Typo.body2" Class="mud-text-secondary mt-1">Hiring or listing products</MudText>
                    </MudPaper>
                </MudItem>

                <!-- Customer -->
                <MudItem xs="12" sm="5">
                    <MudPaper @onclick="@(() => SelectRole("customer"))"
                              Elevation="@(selectedRole == "customer" ? 6 : 2)"
                              Class="@($"pa-8 rounded-xl d-flex flex-column align-center justify-center role-card {(selectedRole == "customer" ? "role-selected" : "")}")"
                              Style="@($"border: 2px solid {(selectedRole == "customer" ? "var(--mud-palette-primary)" : "transparent")}; cursor:pointer; transition:all 0.2s; position:relative; min-height:180px;")">
                        @if (selectedRole == "customer")
                        {
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Primary" Style="position:absolute; top:12px; right:12px;" />
                        }
                        <MudText Style="font-size:3rem;">üõí</MudText>
                        <MudText Typo="Typo.h6" Class="mt-2" Style="font-weight:700;">Customer</MudText>
                        <MudText Typo="Typo.body2" Class="mud-text-secondary mt-1">Looking to buy or browse</MudText>
                    </MudPaper>
                </MudItem>

            </MudGrid>

            <!-- Continue Button -->
            <MudButton Variant="MudVariant.Filled"
                       Color="Color.Primary"
                       Size="Size.Large"
                       Class="mt-10 px-10"
                       Disabled="@string.IsNullOrEmpty(selectedRole)"
                       OnClick="ProceedToRegister"
                       Style="border-radius:10px; font-weight:700; font-size:1rem; min-width:240px;">
                @GetButtonText()
            </MudButton>

            <!-- Links -->
            <MudText Typo="Typo.body2" Class="mt-6 mud-text-secondary">
                Already have an account?
                <MudLink Href="/auth/login" Color="Color.Primary" Style="font-weight:600;">Log In</MudLink>
            </MudText>
            <MudText Typo="Typo.body2" Class="mt-1 mud-text-secondary">
                Just browsing?
                <MudLink Href="/" Color="Color.Primary" Style="font-weight:600;">Back to Home</MudLink>
            </MudText>

        </MudContainer>
    </MudMainContent>

    <MudAppBar Bottom="true" Fixed="true" Elevation="0" Color="Color.Dark" Dense="true">
        <MudText Typo="Typo.caption" Style="width:100%; text-align:center; color:rgba(255,255,255,0.7);">
            ¬© 2025 FastaBiz Inc. ‚Ä¢
            <MudLink Href="#" Typo="Typo.caption" Style="color:rgba(255,255,255,0.9);">Privacy Policy</MudLink>
        </MudText>
    </MudAppBar>
</MudLayout>


@code {
    private string selectedRole = string.Empty;

    private MudTheme _theme = new MudTheme
    {
        PaletteLight = new PaletteLight
        {
            Primary = "#16a34a",
            PrimaryContrastText = "#ffffff",
            AppbarBackground = "#ffffff",
            AppbarText = "#111827",
            Background = "#f9fafb",
            Surface = "#ffffff",
        }
    };

    private void SelectRole(string role) => selectedRole = role;

    private string GetButtonText() => selectedRole switch
    {
        "merchant" => "Register as Business Owner",
        "customer" => "Register as Customer",
        _          => "Select a role to proceed"
    };

    private void ProceedToRegister()
    {
        if (!string.IsNullOrEmpty(selectedRole))
            Navigation.NavigateTo($"/auth/register-form?role={selectedRole}");
    }
}
