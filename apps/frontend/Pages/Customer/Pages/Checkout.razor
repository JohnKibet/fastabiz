@* @page "/customer/checkout"
@layout CustomerLayout

<PageTitle>Checkout</PageTitle>

<div class="max-w-2xl mx-auto p-6 space-y-6 bg-white rounded-xl shadow-sm">
    @if (Invoice is null)
    {
        <p>Loading...</p>
    }
    else
    {
        <div class="divide-y divide-gray-200">
            <OrderSummary Invoice="Invoice" />
            <PaymentMethods 
                SelectedMethod="SelectedMethod" 
                OnMethodChanged="method => SelectedMethod = method" />
            <PaymentForm 
                Method="SelectedMethod" 
                OnSubmit="HandlePayment" 
                IsLoading="@IsProcessing" />
            <PaymentStatus Status="@PaymentResult" />
        </div>
    }
</div>

@code {
    [Parameter] public Guid InvoiceId { get; set; }

    private Invoice? Invoice;
    private string? SelectedMethod;
    private string? PaymentResult;
    private bool IsProcessing;

    protected override async Task OnInitializedAsync()
    {
    }

    private async Task HandlePayment()
    {
    }
} *@

@page "/customer/checkout"
@layout CustomerLayout
@using frontend.Models
@using frontend.Pages.Shared.Components.Cart
@inject CartService CartService
@inject NavigationManager Navigation

<div class="p-2">
    <h1 class="text-2xl font-bold mb-6">Checkout</h1>

    @if (!CartService.Items.Any())
    {
        <p class="text-gray-500">
            Your cart is empty. 
            <button class="text-stoneblue font-medium" @onclick="GoShop">Shop Now</button>
        </p>
    }
    else
    {
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Cart Items -->
            <CartCard />

            <!-- Delivery & Actions -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="font-semibold text-lg mb-4">Delivery Info</h2>
                <div class="flex flex-col gap-4">
                    <input type="text" placeholder="Delivery Address" class="border rounded px-3 py-2" @bind="DeliveryAddress" />
                    <input type="text" placeholder="Pickup Address" class="border rounded px-3 py-2" @bind="PickupAddress" />
                </div>

                <button class="mt-6 w-full px-6 py-3 bg-stoneblue text-white rounded shadow hover:bg-stoneblue/90"
                        @onclick="GoToPayment">
                    Proceed to Payment
                </button>
            </div>
        </div>
    }
</div>


@code {
    private string DeliveryAddress { get; set; } = "";
    private string PickupAddress { get; set; } = "";

    private void GoShop() => Navigation.NavigateTo("/storefront");

    private void GoToPayment()
    {
        if (string.IsNullOrWhiteSpace(DeliveryAddress) || string.IsNullOrWhiteSpace(PickupAddress))
        {
            // TODO: show validation error
            return;
        }

        Navigation.NavigateTo($"/payment?delivery={Uri.EscapeDataString(DeliveryAddress)}&pickup={Uri.EscapeDataString(PickupAddress)}");
    }
}

