@namespace frontend.Pages.Shared.Components.Modals
@using frontend.Models
@using System.ComponentModel.DataAnnotations

@if (Show)
{
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 shadow-xl w-96">

            <h3 class="text-xl font-semibold text-gray-800 mb-4">Edit Profile</h3>

            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <p class="text-red-500 text-sm mb-2">@ErrorMessage</p>
            }

            <EditForm Model="@Model" OnValidSubmit="@Submit">
                <DataAnnotationsValidator />

                <!-- Hidden Slug (required for backend updates) -->
                @* <InputHidden @bind-Value="Model.Slug" /> *@

                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">Full Name</label>
                    <InputText @bind-Value="Model.FullName"
                               class="mt-1 w-full p-2 border rounded-lg" />
                    <ValidationMessage For="@(() => Model.FullName)" />
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">Email</label>
                    <InputText @bind-Value="Model.Email"
                               class="mt-1 w-full p-2 border rounded-lg" />
                    <ValidationMessage For="@(() => Model.Email)" />
                </div>

                <div class="mb-3">
                    <label class="block text-sm font-medium text-gray-700">Phone</label>
                    <InputText @bind-Value="Model.Phone"
                               class="mt-1 w-full p-2 border rounded-lg" />
                    <ValidationMessage For="@(() => Model.Phone)" />
                </div>

                <div class="flex justify-end mt-4 space-x-2">
                    <button type="button"
                            class="px-4 py-2 bg-gray-200 rounded-lg"
                            @onclick="Close">
                        Cancel
                    </button>

                    <button type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                        Save Changes
                    </button>
                </div>
            </EditForm>

        </div>
    </div>
}

@code {
    [Parameter] public bool Show { get; set; }
    [Parameter] public EventCallback<bool> ShowChanged { get; set; }

    public EditUserModel Model { get; set; } = new();

    public string? ErrorMessage { get; set; }

    public void Load(EditUserModel user)
    {
        // preload user data before opening modal
        Model = new EditUserModel
        {
            FullName = user.FullName,
            Email = user.Email,
            Phone = user.Phone,
            Slug = user.Slug
        };
    }

    async Task Submit()
    {
        ErrorMessage = null;

        // TODO: Replace with real API call
        var result = true;

        if (result)
        {
            await ShowChanged.InvokeAsync(false);
        }
        else
        {
            ErrorMessage = "Failed to update profile.";
        }
    }

    void Close() => ShowChanged.InvokeAsync(false);
}

