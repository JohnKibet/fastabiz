@namespace frontend.Pages.Shared.Components.Storefront
@using frontend.Pages.Shared.Components.Icons
@inject IJSRuntime JS

<div class="fixed inset-0 z-50 flex" style="display:@(IsOpen ? "flex" : "none")">

    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black bg-opacity-40" @onclick="OnClose"></div>

    <!-- Drawer -->
    <div class="relative bg-white w-72 h-full shadow-xl transform transition-transform duration-300 ease-in-out flex flex-col"
         style="transform: translateX(@(IsOpen ? "0" : "-100%"));">
        
        <!-- Close button -->
        <button class="absolute top-4 right-8 text-gray-700 hover:text-gray-900" @onclick="OnClose">
            <LucideIcon Name="close" Size="24" Class="w-6 h-6" />
        </button>

        <!-- Scrollable drawer content -->
        <div class="mt-12 flex-1 overflow-y-auto p-4">
            <div class="mb-4">
                <label class="block font-medium mb-1">Category</label>
                <CategoryFilter Categories="@Categories" SelectedCategory="@SelectedCategory" OnCategorySelected="@FilterByCategory" />
            </div>

            <div class="mb-4">
                <label class="block font-medium mb-1">Merchant</label>
                <MerchantFilter Merchants="@Merchants" OnMerchantSelected="@FilterByMerchant" />
            </div>

            <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                Apply Filters
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private List<ProductListItem> Products = MockData.GetAllProducts();
    private List<ProductListItem> FilteredProducts = new();
    private List<string> Categories = MockData.GetAllCategories();
    private List<Merchant> Merchants = MockData.Merchants;
    private string? SelectedCategory;
    private string? SelectedMerchantId;

    protected override void OnInitialized()
    {
        FilteredProducts = Products;
    }

    protected override async Task OnParametersSetAsync()
    {
        // Lock or unlock background scrolling
        await JS.InvokeVoidAsync("toggleBodyScroll", IsOpen);
    }

    private void FilterByCategory(string category)
    {
        SelectedCategory = category;
        ApplyFilters();
    }

    private void FilterByMerchant(string merchantId)
    {
        SelectedMerchantId = merchantId;
        ApplyFilters();
    }

    private void ApplyFilters()
    {
        FilteredProducts = Products;

        if (!string.IsNullOrEmpty(SelectedCategory))
            FilteredProducts = FilteredProducts.Where(p => p.Category == SelectedCategory).ToList();

        if (!string.IsNullOrEmpty(SelectedMerchantId))
            FilteredProducts = FilteredProducts.Where(p => p.MerchantId == SelectedMerchantId).ToList();
    }
}

