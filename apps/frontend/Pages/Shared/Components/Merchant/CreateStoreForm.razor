@using frontend.Models
@namespace frontend.Pages.Shared.Components.Merchant
@inject HttpClient Http
@inject ToastService ToastService
@inject StoreService StoreService
@inject NavigationManager Navigation

<div class="min-h-screen bg-bgSoft flex items-start justify-start p-2">
  <div class="w-full max-w-xl bg-white rounded-2xl shadow p-8">
    <h1 class="text-2xl font-poppins font-semibold text-textDark mb-2">Create Store</h1>
    <p class="text-textLight mb-6">Set up your storefront details</p>


    <EditForm Model="@store" OnValidSubmit="HandleValidSubmit">
      <DataAnnotationsValidator />


      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-textDark">Store Name</label>
          <InputText @bind-Value="store.Name" class="w-full mt-1 px-4 py-2 border rounded-lg" />
          <ValidationMessage For="() => store.Name" />
        </div>


        <div>
          <label class="block text-sm font-medium text-textDark">Location</label>
          <InputText @bind-Value="store.Location" class="w-full mt-1 px-4 py-2 border rounded-lg" />
          <ValidationMessage For="() => store.Location" />
        </div>


        <div>
          <label class="block text-sm font-medium text-textDark">Logo URL</label>
          <InputText @bind-Value="store.Logo" class="w-full mt-1 px-4 py-2 border rounded-lg" />
        </div>
      </div>


      <button type="submit" class="mt-6 w-full bg-primary text-white py-2 rounded-xl hover:bg-ctaHover transition">
        Create Store
      </button>
    </EditForm>
  </div>
</div>

@code {
  private CreateStoreRequest store = new()
  {
    Id = Guid.NewGuid()
  };
  private bool isSubmitting = false;

  private async Task HandleValidSubmit()
  {
    try
    {
      isSubmitting = true;
      var result = await StoreService.CreateStore(store);
      if (result.Success)
      {
        ToastService.ShowToast("Store created successfully", ToastService.ToastLevel.Success);
        Navigation.NavigateTo($"merchant/products/create/{store.Id}");
        return;
      }

      var errMessage = result.Error;
      if (errMessage == null)
      {
        ToastService.ShowToast("Failed to create store (unknown error)", ToastService.ToastLevel.Error);
        return;
      }

      if (!string.IsNullOrWhiteSpace(errMessage.Detail))
      {
        ToastService.ShowToast(errMessage.Detail, ToastService.ToastLevel.Error);
        return;
      }

      ToastService.ShowToast("Failed to create store", ToastService.ToastLevel.Error);
    }
    catch (Exception ex)
    {
      ToastService.ShowToast($"Error: {ex.Message}", ToastService.ToastLevel.Error);
    }
    finally
    {
      isSubmitting = false;
    }
  }
}