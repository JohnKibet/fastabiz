@inject ToastService ToastService

<div class="toast">
    @foreach (var toast in toasts)
    {
        <div class="toast-item @GetToastCss(toast.Level)">
            <div class="flex justify-between items-center">
                <div class="flex-1">
                    <strong>@toast.Message:</strong>
                    @if (!string.IsNullOrWhiteSpace(toast.ErrDetail))
                    {
                        <div class="toast-detail"> @toast.ErrDetail</div>
                    }
                </div>
                <button class="ml-4 text-gray-500 hover:text-black transition" @onclick="@(() => RemoveToast(toast))" aria-label="Close toast">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M18 6L6 18M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>
    }
</div>

@code {
    private List<ToastService.ToastMessage> toasts = new();

    protected override void OnInitialized()
    {
        ToastService.OnShow += ShowToast;
    }

    private void ShowToast(ToastService.ToastMessage toast)
    {
        toasts.Add(toast);
        InvokeAsync(StateHasChanged);

        _ = Task.Delay(toast.DurationMs).ContinueWith(_ =>
        {
            toasts.Remove(toast);
            InvokeAsync(StateHasChanged);
        });
    }

    private void RemoveToast(ToastService.ToastMessage toast)
    {
        toasts.Remove(toast);
        StateHasChanged();
    }

    private string GetToastCss(ToastService.ToastLevel level)
    {
        return level switch
        {
            ToastService.ToastLevel.Success => "toast-success",
            ToastService.ToastLevel.Error => "toast-error",
            ToastService.ToastLevel.Warning => "toast-warning",
            ToastService.ToastLevel.Info => "toast-info",
            _ => "bg-blue-100 text-blue-800 p-4 rounded shadow",
        };
    }
}
